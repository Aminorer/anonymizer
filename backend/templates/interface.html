<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Interface Unifiée</title>
  <link rel="stylesheet" href="/static/css/styles.css" />
  <link rel="stylesheet" href="/static/css/interface.css" />
</head>
<body>
  <div id="app">
    <h2>Interface Unifiée</h2>
    <div class="controls">
      <button @click="changeView('original')">Original</button>
      <button @click="changeView('anonymized')">Anonymisé</button>
      <button @click="zoomIn">Zoom +</button>
      <button @click="zoomOut">Zoom -</button>
    </div>
    <div class="container">
      <div id="viewer" class="viewer"></div>
      <div class="side-panel">
        <div class="tabs">
          <button @click="activeTab='entities'">Entités</button>
          <button @click="activeTab='groups'">Groupes</button>
          <button @click="activeTab='search'">Recherche</button>
          <button @click="activeTab='rules'">Règles</button>
        </div>
        <div v-if="activeTab==='entities'">
          <div class="entity-actions">
            <button @click="showDetectionModal=true">Ajouter détection</button>
            <button @click="deleteSelected">Supprimer sélection</button>
          </div>
          <table class="entity-table">
            <thead>
              <tr><th></th><th>Type</th><th>Valeur</th></tr>
            </thead>
            <tbody>
              <tr v-for="(ent,idx) in entityStore.items" :key="ent.id" draggable="true"
                  @dragstart="dragStart(idx,$event)" @dragover.prevent @drop="drop(idx)">
                <td><input type="checkbox" v-model="selected" :value="ent.id" /></td>
                <td><input v-model="ent.type" @change="updateEntity(ent)" /></td>
                <td><input v-model="ent.value" @change="updateEntity(ent)" /></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div v-if="activeTab==='groups'">
          <div class="group-actions">
            <button @click="showGroupModal=true">Créer groupe</button>
          </div>
          <ul class="group-list">
            <li v-for="grp in groupStore.items" :key="grp.id" @dragover.prevent @drop="assignToGroup(grp.id,$event)">
              {{ grp.name }} ({{ grp.entities.length }})
              <button @click="deleteGroup(grp.id)">x</button>
            </li>
          </ul>
        </div>
        <div v-if="activeTab==='search'">
          <select v-model="searchType">
            <option value="text">Texte</option>
            <option value="regex">Regex</option>
            <option value="semantic">Sémantique</option>
          </select>
          <input v-model="searchTerm" placeholder="Rechercher" />
          <button @click="search">Go</button>
        </div>
        <div v-if="activeTab==='rules'">
          <p>Règles (placeholder)</p>
        </div>
      </div>
    </div>
    <div v-if="showDetectionModal" class="modal">
      <div class="modal-content">
        <h3>Ajouter détection</h3>
        <input v-model="newDetection.type" placeholder="Type" />
        <input v-model="newDetection.value" placeholder="Valeur" />
        <button @click="confirmDetection">Ajouter</button>
        <button @click="showDetectionModal=false">Annuler</button>
      </div>
    </div>
    <div v-if="showGroupModal" class="modal">
      <div class="modal-content">
        <h3>Créer groupe</h3>
        <input v-model="newGroupName" placeholder="Nom du groupe" />
        <button @click="confirmGroup">Créer</button>
        <button @click="showGroupModal=false">Annuler</button>
      </div>
    </div>
    <div id="download" v-if="status">
      <a :href="status.download_url">Télécharger anonymisé</a> |
      <a :href="status.original_url">Télécharger original</a>
    </div>
  </div>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/pinia@2/dist/pinia.iife.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://unpkg.com/docx-preview@0.4.1/dist/docx-preview.js"></script>
  <script src="/static/js/app.js"></script>
</body>
</html>
